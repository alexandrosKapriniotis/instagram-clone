{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport AppState from \"react-native-web/dist/exports/AppState\";\nimport * as ImagePicker from 'expo-image-picker';\nimport { Camera } from 'expo-camera';\nimport { useIsFocused } from '@react-navigation/native';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Media(_ref) {\n  var navigation = _ref.navigation;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      hasGalleryPermission = _useState2[0],\n      setHasGalleryPermission = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      hasCameraPermission = _useState4[0],\n      setHasCameraPermission = _useState4[1];\n\n  var _useState5 = useState(Camera.Constants.Type.back),\n      _useState6 = _slicedToArray(_useState5, 2),\n      type = _useState6[0],\n      setType = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      image = _useState8[0],\n      setImage = _useState8[1];\n\n  var cameraRef = useRef();\n  var isFocused = useIsFocused();\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      imagePickerActive = _useState10[0],\n      setImagePickerActive = _useState10[1];\n\n  var _useState11 = useState(true),\n      _useState12 = _slicedToArray(_useState11, 2),\n      camera = _useState12[0],\n      setCamera = _useState12[1];\n\n  var appState = useRef(AppState.currentState);\n  useEffect(function () {\n    (function _callee() {\n      var cameraStatus, galleryStatus;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(ImagePicker.requestCameraPermissionsAsync());\n\n            case 2:\n              cameraStatus = _context.sent;\n              setHasCameraPermission(cameraStatus.status === 'granted');\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(ImagePicker.requestMediaLibraryPermissionsAsync());\n\n            case 6:\n              galleryStatus = _context.sent;\n              setHasGalleryPermission(galleryStatus.status === 'granted');\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n  useEffect(function () {\n    var stateListener = AppState.addEventListener('change', _handleAppStateChange);\n    return stateListener;\n  }, []);\n\n  var _handleAppStateChange = function _handleAppStateChange(nextAppState) {\n    if (appState.current !== 'background' && !imagePickerActive || appState.current !== 'inactive' && !imagePickerActive) {\n      setCamera(true);\n    } else {\n      setCamera(false);\n    }\n  };\n\n  var pickImage = function pickImage() {\n    var _ImagePicker$MediaTyp;\n\n    var result;\n    return _regeneratorRuntime.async(function pickImage$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (hasGalleryPermission) {\n              _context2.next = 3;\n              break;\n            }\n\n            alert(\"You've refused to allow this appp to access your photos!\");\n            return _context2.abrupt(\"return\");\n\n          case 3:\n            setImagePickerActive(true);\n            _context2.next = 6;\n            return _regeneratorRuntime.awrap(ImagePicker == null ? void 0 : ImagePicker.launchImageLibraryAsync({\n              mediaTypes: ImagePicker == null ? void 0 : (_ImagePicker$MediaTyp = ImagePicker.MediaTypeOptions) == null ? void 0 : _ImagePicker$MediaTyp.Images,\n              allowsEditing: true,\n              aspect: [1, 1],\n              quality: 1\n            }));\n\n          case 6:\n            result = _context2.sent;\n\n            if (!(result != null && result.cancelled)) {\n              setImage(result == null ? void 0 : result.uri);\n            }\n\n            setImagePickerActive(false);\n            setCamera(true);\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var takePicture = function takePicture() {\n    var options, data, source;\n    return _regeneratorRuntime.async(function takePicture$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (!cameraRef.current) {\n              _context3.next = 7;\n              break;\n            }\n\n            options = {\n              quality: 0.5,\n              base64: true,\n              skipProcessing: true\n            };\n            _context3.next = 4;\n            return _regeneratorRuntime.awrap(cameraRef.current.takePictureAsync(options));\n\n          case 4:\n            data = _context3.sent;\n            source = data.uri;\n\n            if (source) {\n              setImage(data.uri);\n            }\n\n          case 7:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  if (hasCameraPermission === null || hasGalleryPermission === null) {\n    return _jsx(View, {});\n  }\n\n  if (hasCameraPermission === false || hasGalleryPermission === false) {\n    return _jsx(Text, {\n      children: \"No access to camera\"\n    });\n  }\n\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(View, {\n      style: styles.camera,\n      children: camera && isFocused && !imagePickerActive && _jsx(Camera, {\n        ref: cameraRef,\n        style: styles.fixedRatio,\n        type: type,\n        ratio: '1:1',\n        useCamera2Api: false\n      })\n    }), _jsx(Button, {\n      title: \"Flip image\",\n      style: styles.button,\n      onPress: function onPress() {\n        setType(type === Camera.Constants.Type.back ? Camera.Constants.Type.front : Camera.Constants.Type.back);\n      }\n    }), _jsx(Button, {\n      title: \"Take picture\",\n      onPress: function onPress() {\n        return takePicture();\n      }\n    }), _jsx(Button, {\n      title: \"Pick Image from gallery\",\n      onPress: function onPress() {\n        setCamera(false);\n        pickImage();\n      }\n    }), _jsx(Button, {\n      title: \"Save\",\n      onPress: function onPress() {\n        return navigation.navigate('Save', {\n          image: image\n        });\n      }\n    }), image && image !== null && _jsx(Image, {\n      source: {\n        uri: image\n      },\n      style: {\n        flex: 1\n      }\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  camera: {\n    flex: 1,\n    flexDirection: 'row'\n  },\n  fixedRatio: {\n    flex: 1,\n    aspectRatio: 1\n  }\n});","map":{"version":3,"sources":["C:/Users/sim2a/Documents/codes/instagram-clone/components/Add/Media.js"],"names":["React","useEffect","useRef","useState","ImagePicker","Camera","useIsFocused","Media","navigation","hasGalleryPermission","setHasGalleryPermission","hasCameraPermission","setHasCameraPermission","Constants","Type","back","type","setType","image","setImage","cameraRef","isFocused","imagePickerActive","setImagePickerActive","camera","setCamera","appState","AppState","currentState","requestCameraPermissionsAsync","cameraStatus","status","requestMediaLibraryPermissionsAsync","galleryStatus","stateListener","addEventListener","_handleAppStateChange","nextAppState","current","pickImage","alert","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","Images","allowsEditing","aspect","quality","result","cancelled","uri","takePicture","options","base64","skipProcessing","takePictureAsync","data","source","styles","container","fixedRatio","button","front","navigate","flex","StyleSheet","create","flexDirection","aspectRatio"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { StyleSheet, Text, View, Button,Image,AppState } from 'react-native';\r\nimport * as ImagePicker from 'expo-image-picker';\r\nimport { Camera } from 'expo-camera';\r\nimport { useIsFocused } from '@react-navigation/native';\r\n\r\nexport default function Media({navigation}) {\r\n  const [hasGalleryPermission, setHasGalleryPermission] = useState(null);\r\n  const [hasCameraPermission, setHasCameraPermission] = useState(null);\r\n  const [type, setType] = useState(Camera.Constants.Type.back);\r\n  const [image, setImage] = useState(null);\r\n  const cameraRef = useRef();\r\n  const isFocused = useIsFocused();\r\n\r\n  const [imagePickerActive, setImagePickerActive] = useState(false);\r\n  const [camera, setCamera] = useState(true);\r\n  const appState = useRef(AppState.currentState);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const cameraStatus = await ImagePicker.requestCameraPermissionsAsync();\r\n      setHasCameraPermission(cameraStatus.status === 'granted');\r\n\r\n      const galleryStatus = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n      setHasGalleryPermission(galleryStatus.status === 'granted');\r\n    })();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const stateListener = AppState.addEventListener('change', _handleAppStateChange);\r\n\r\n    return stateListener;\r\n  }, []);\r\n\r\n  const _handleAppStateChange = nextAppState => {\r\n    if (appState.current !== 'background' && !imagePickerActive || appState.current !== 'inactive' && !imagePickerActive) {\r\n      setCamera(true);\r\n    } else {\r\n      setCamera(false);\r\n    }   \r\n  };\r\n  const pickImage = async () => {\r\n    if (!hasGalleryPermission) {\r\n      alert(\"You've refused to allow this appp to access your photos!\");\r\n      return;\r\n    }\r\n    setImagePickerActive(true)\r\n    \r\n    let result = await ImagePicker?.launchImageLibraryAsync({\r\n      mediaTypes: ImagePicker?.MediaTypeOptions?.Images,\r\n      allowsEditing: true,\r\n      aspect: [1, 1],\r\n      quality: 1,\r\n    });\r\n\r\n\r\n    if (!result?.cancelled) {\r\n      setImage(result?.uri);\r\n    }\r\n\r\n    setImagePickerActive(false)\r\n    setCamera(true)\r\n  };\r\n\r\n  const takePicture = async () => {\r\n    if(cameraRef.current) {\r\n      const options = { quality: 0.5, base64: true, skipProcessing: true };\r\n      const data = await cameraRef.current.takePictureAsync(options);\r\n      const source = data.uri;\r\n      if (source) {\r\n          setImage(data.uri)\r\n      }\r\n    }\r\n  }\r\n\r\n  if (hasCameraPermission === null || hasGalleryPermission === null) {\r\n    return <View />;\r\n  }\r\n  if (hasCameraPermission === false || hasGalleryPermission === false) {\r\n    return <Text>No access to camera</Text>;\r\n  }\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.camera}>\r\n      { camera && isFocused && !imagePickerActive &&\r\n        <Camera\r\n          ref={cameraRef} \r\n          style={styles.fixedRatio} \r\n          type={type} \r\n          ratio={'1:1'}\r\n          useCamera2Api={false}\r\n        /> }\r\n      </View>\r\n      \r\n      <Button\r\n        title='Flip image'\r\n        style={styles.button}\r\n        onPress={() => {\r\n          setType(\r\n            type === Camera.Constants.Type.back\r\n              ? Camera.Constants.Type.front\r\n              : Camera.Constants.Type.back\r\n          );\r\n        }}>\r\n      </Button>\r\n      <Button \r\n        title='Take picture' \r\n        onPress={() => takePicture()} />\r\n      <Button \r\n        title='Pick Image from gallery' \r\n        onPress={() => {\r\n          setCamera(false);\r\n          pickImage();\r\n        }} \r\n      />\r\n      <Button \r\n        title='Save' \r\n        onPress={() => navigation.navigate('Save',{image})} />\r\n      {image && image !== null && <Image source={{uri: image}} style={{flex:1}} />}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1\r\n  },\r\n  camera: {\r\n    flex: 1,\r\n    flexDirection: 'row'\r\n  },\r\n  fixedRatio: {\r\n    flex: 1,\r\n    aspectRatio: 1\r\n  }\r\n}); \r\n"]},"metadata":{},"sourceType":"module"}