{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport { Divider, Snackbar } from 'react-native-paper';\nimport { arrayRemove, arrayUnion, collection, deleteDoc, doc, getDoc, onSnapshot, setDoc, updateDoc } from 'firebase/firestore';\nimport { useNavigation, useIsFocused } from '@react-navigation/native';\nimport BottomSheet from 'reanimated-bottom-sheet';\nimport ParsedText from 'react-native-parsed-text';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { Entypo, Feather, FontAwesome5 } from '@expo/vector-icons';\nimport { fetchUserPosts, deletePost } from \"../../redux/actions\";\nimport { container, text, utils } from \"../styles\";\nimport { timeDifference } from \"../utils\";\nimport CachedImage from \"../CachedImage\";\nimport { auth, db } from \"../../firebase\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nvar WINDOW_WIDTH = Dimensions.get(\"window\").width;\n\nfunction Post(props) {\n  var navigation = useNavigation();\n  var post = props.post;\n\n  var _useState = useState(props.route.params.item),\n      _useState2 = _slicedToArray(_useState, 2),\n      item = _useState2[0],\n      setItem = _useState2[1];\n\n  var _useState3 = useState(props.route.params.user),\n      _useState4 = _slicedToArray(_useState3, 2),\n      user = _useState4[0],\n      setUser = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      currentUserLike = _useState6[0],\n      setCurrentUserLike = _useState6[1];\n\n  var _useState7 = useState(true),\n      _useState8 = _slicedToArray(_useState7, 2),\n      unmutted = _useState8[0],\n      setUnmutted = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      videoref = _useState10[0],\n      setvideoref = _useState10[1];\n\n  var _useState11 = useState(useRef(null)),\n      _useState12 = _slicedToArray(_useState11, 2),\n      sheetRef = _useState12[0],\n      setSheetRef = _useState12[1];\n\n  var _useState13 = useState({\n    visible: false,\n    item: null\n  }),\n      _useState14 = _slicedToArray(_useState13, 2),\n      modalShow = _useState14[0],\n      setModalShow = _useState14[1];\n\n  var _useState15 = useState(true),\n      _useState16 = _slicedToArray(_useState15, 2),\n      isValid = _useState16[0],\n      setIsValid = _useState16[1];\n\n  var _useState17 = useState(false),\n      _useState18 = _slicedToArray(_useState17, 2),\n      exists = _useState18[0],\n      setExists = _useState18[1];\n\n  var _useState19 = useState(false),\n      _useState20 = _slicedToArray(_useState19, 2),\n      loaded = _useState20[0],\n      setLoaded = _useState20[1];\n\n  var isFocused = useIsFocused();\n  useEffect(function () {\n    if (props.route.params.notification != undefined) {\n      var userDoc = doc(db, \"users\", props.route.params.user);\n      getDoc(userDoc).then(function (snapshot) {\n        if (snapshot.exists) {\n          var _user = snapshot.data();\n\n          _user.uid = snapshot.id;\n          setUser(_user);\n        }\n      }).catch(function (error) {\n        return console.log(error);\n      });\n      var userPostsRef = collection(db, \"posts\", props.route.params.user, \"userPosts\");\n      var userPostRef = doc(userPostsRef, props.route.params.item);\n      getDoc(userPostRef).then(function (snapshot) {\n        if (snapshot.exists) {\n          var _post = snapshot.data();\n\n          _post.id = snapshot.id;\n          setItem(_post);\n          setLoaded(true);\n          setExists(true);\n        }\n      }).catch(function (error) {\n        return console.log(error);\n      });\n      var likesRef = collection(userPostsRef, props.route.params.item, \"likes\");\n      var currentUserDocRef = doc(likesRef, auth.currentUser.uid);\n      onSnapshot(currentUserDocRef, function (snapshot) {\n        var currentUserLike = false;\n\n        if (snapshot.exists) {\n          currentUserLike = true;\n        }\n\n        setCurrentUserLike(currentUserLike);\n      });\n    } else {\n      var currentUserRef = doc(db, \"posts\", props.route.params.user.uid, \"userPosts\", props.route.params.item.id, \"likes\", auth.currentUser.uid);\n      onSnapshot(currentUserRef, function (snapshot) {\n        var currentUserLike = false;\n\n        if (snapshot.exists) {\n          currentUserLike = true;\n        }\n\n        setCurrentUserLike(currentUserLike);\n      });\n      setItem(props.route.params.item);\n      setUser(props.route.params.user);\n      setLoaded(true);\n      setExists(true);\n    }\n  }, [props.route.params.notification, props.route.params.item]);\n  useEffect(function () {\n    if (videoref !== null) {\n      videoref.setIsMutedAsync(props.route.params.unmutted);\n    }\n\n    setUnmutted(props.route.params.unmutted);\n  }, [props.route.params.unmutted]);\n  useEffect(function () {\n    if (videoref !== null) {\n      if (isFocused) {\n        videoref.playAsync();\n      } else {\n        videoref.stopAsync();\n      }\n    }\n  }, [props.route.params.index, props.route.params.inViewPort]);\n\n  var handleLike = function handleLike() {\n    var _post$likes_by_users;\n\n    var currentLikeStatus = !((_post$likes_by_users = post.likes_by_users) != null && _post$likes_by_users.includes(auth.currentUser.uid));\n    var postRef = collection(db, \"users\", post.owner_email, \"posts\");\n    updateDoc(doc(postRef, post.id), {\n      likes_by_users: currentLikeStatus ? arrayUnion(auth.currentUser.uid) : arrayRemove(auth.currentUser.uid)\n    }).then(function () {\n      console.log('Document successfully added');\n    }).catch(function (error) {\n      console.log('Error updating document: ', error.message);\n    });\n  };\n\n  var handleComment = function handleComment(post) {\n    navigation.navigate('CommentsScreen', {\n      postId: post.id,\n      uid: auth.currentUser.uid\n    });\n  };\n\n  var onUsernamePress = function onUsernamePress(username, matchIndex) {\n    navigation.navigate(\"Profile\", {\n      username: username,\n      uid: undefined\n    });\n  };\n\n  var onLikePress = function onLikePress(userId, postId, item) {\n    item.likesCount += 1;\n    setCurrentUserLike(true);\n    var currentUserRef = doc(db, \"posts\", userId, \"userPosts\", postId, \"likes\", auth.currentUser.uid);\n    setDoc(currentUserRef, {});\n  };\n\n  var onDislikePress = function onDislikePress(userId, postId, item) {\n    var currentUserRef = doc(db, \"posts\", userId, \"userPosts\", postId, \"likes\", auth.currentUser.uid);\n    deleteDoc(currentUserRef);\n  };\n\n  if (!exists && loaded) {\n    return _jsxs(View, {\n      style: {\n        height: '100%',\n        justifyContent: 'center',\n        margin: 'auto'\n      },\n      children: [_jsx(FontAwesome5, {\n        style: {\n          alignSelf: 'center',\n          marginBottom: 20\n        },\n        name: \"dizzy\",\n        size: 40,\n        color: \"black\"\n      }), _jsx(Text, {\n        style: [text.notAvailable],\n        children: \"Post does not exist\"\n      })]\n    });\n  }\n\n  if (!loaded) {\n    return _jsx(View, {});\n  }\n\n  if (user == undefined) {\n    return _jsx(View, {});\n  }\n\n  if (item == null) {\n    return _jsx(View, {});\n  }\n\n  var _handleVideoRef = function _handleVideoRef(component) {\n    setvideoref(component);\n\n    if (component !== null) {\n      component.setIsMutedAsync(props.route.params.unmutted);\n    }\n  };\n\n  if (videoref !== null) {\n    videoref.setIsMutedAsync(unmutted);\n\n    if (isFocused && props.route.params.index == props.route.params.inViewPort) {\n      videoref.playAsync();\n    } else {\n      videoref.stopAsync();\n    }\n  }\n\n  if (sheetRef.current !== null && !props.route.params.feed) {\n    if (modalShow.visible) {\n      sheetRef.snapTo(0);\n    } else {\n      sheetRef.snapTo(1);\n    }\n  }\n\n  return _jsxs(View, {\n    style: [container.container, utils.backgroundWhite],\n    children: [_jsxs(View, {\n      children: [_jsxs(View, {\n        style: [container.horizontal, {\n          alignItems: 'center',\n          padding: 10\n        }],\n        children: [_jsxs(TouchableOpacity, {\n          style: [container.horizontal, {\n            alignItems: 'center'\n          }],\n          onPress: function onPress() {\n            return navigation.navigate(\"BottomTabs\", {\n              screen: \"ProfileScreen\",\n              params: {\n                uid: user.uid,\n                username: undefined\n              }\n            });\n          },\n          children: [user.image == 'default' ? _jsx(FontAwesome5, {\n            style: [utils.profileImageSmall],\n            name: \"user-circle\",\n            size: 35,\n            color: \"black\"\n          }) : _jsx(Image, {\n            style: [utils.profileImageSmall],\n            source: {\n              uri: user.profile_picture\n            }\n          }), _jsx(View, {\n            style: {\n              alignSelf: 'center'\n            },\n            children: _jsx(Text, {\n              style: [text.bold, text.medium, {\n                marginBottom: 0\n              }],\n              children: user.username\n            })\n          })]\n        }), _jsx(TouchableOpacity, {\n          style: [{\n            marginLeft: 'auto'\n          }],\n          onPress: function onPress() {\n            if (props.route.params.feed) {\n              props.route.params.setModalShow({\n                visible: true,\n                item: item\n              });\n            } else {\n              setModalShow({\n                visible: true,\n                item: item\n              });\n            }\n          },\n          children: _jsx(Feather, {\n            name: \"more-vertical\",\n            size: 20,\n            color: \"black\"\n          })\n        })]\n      }), item.type == 0 ? _jsx(_Fragment, {\n        children: props.route.params.index == props.route.params.inViewPort && isFocused ? _jsxs(View, {\n          children: [_jsx(VideoPlayer, {\n            videoProps: {\n              isLooping: true,\n              shouldPlay: true,\n              resizeMode: Video.RESIZE_MODE_COVER,\n              source: {\n                uri: item.downloadURL\n              },\n              videoRef: _handleVideoRef\n            },\n            inFullscreen: false,\n            showControlsOnLoad: true,\n            showFullscreenButton: false,\n            height: WINDOW_WIDTH,\n            width: WINDOW_WIDTH,\n            shouldPlay: true,\n            isLooping: true,\n            style: {\n              aspectRatio: 1 / 1,\n              height: WINDOW_WIDTH,\n              width: WINDOW_WIDTH,\n              backgroundColor: 'black'\n            }\n          }), _jsx(TouchableOpacity, {\n            style: {\n              position: 'absolute',\n              borderRadius: 500,\n              backgroundColor: 'black',\n              width: 40,\n              height: 40,\n              alignItems: 'center',\n              justifyContent: 'center',\n              margin: 10,\n              right: 0\n            },\n            activeOpacity: 1,\n            onPress: function onPress() {\n              if (videoref == null) {\n                return;\n              }\n\n              if (unmutted) {\n                if (props.route.params.setUnmuttedMain == undefined) {\n                  setUnmutted(false);\n                } else {\n                  props.route.params.setUnmuttedMain(false);\n                }\n              } else {\n                if (props.route.params.setUnmuttedMain == undefined) {\n                  setUnmutted(true);\n                } else {\n                  props.route.params.setUnmuttedMain(true);\n                }\n              }\n            },\n            children: !unmutted ? _jsx(Feather, {\n              name: \"volume-2\",\n              size: 20,\n              color: \"white\"\n            }) : _jsx(Feather, {\n              name: \"volume-x\",\n              size: 20,\n              color: \"white\"\n            })\n          })]\n        }) : _jsx(View, {\n          style: {\n            marginTop: 4\n          },\n          children: _jsx(CachedImage, {\n            cacheKey: item.id,\n            style: [container.image],\n            source: {\n              uri: item.downloadURLStill\n            }\n          })\n        })\n      }) : _jsx(CachedImage, {\n        cacheKey: item.id,\n        style: container.image,\n        source: {\n          uri: item.downloadURL\n        }\n      }), _jsx(Feather, {\n        style: utils.margin15Left,\n        name: \"message-square\",\n        size: 30,\n        color: \"black\",\n        onPress: function onPress() {\n          return navigation.navigate('CommentsScreen', {\n            postId: item.id,\n            uid: user.uid,\n            user: user\n          });\n        }\n      }), _jsxs(View, {\n        style: [utils.padding10, container.horizontal],\n        children: [currentUserLike ? _jsx(TouchableOpacity, {\n          onPress: function onPress() {\n            return onDislikePress(user.uid, item.id, item);\n          },\n          children: _jsx(Entypo, {\n            name: \"heart\",\n            size: 30,\n            color: \"red\"\n          })\n        }) : _jsx(TouchableOpacity, {\n          onPress: function onPress() {\n            return onLikePress(user.uid, item.id, item);\n          },\n          children: _jsx(Feather, {\n            name: \"heart\",\n            size: 30,\n            color: \"black\"\n          })\n        }), _jsx(Feather, {\n          style: utils.margin15Left,\n          name: \"share\",\n          size: 26,\n          color: \"black\",\n          onPress: function onPress() {\n            return navigation.navigate('ChatList', {\n              postId: item.id,\n              post: _objectSpread(_objectSpread({}, item), {}, {\n                user: user\n              }),\n              share: true\n            });\n          }\n        })]\n      }), _jsxs(View, {\n        style: [container.container, utils.padding10Sides],\n        children: [_jsxs(Text, {\n          style: [text.bold, text.medium],\n          children: [item.likesCount, \" likes\"]\n        }), _jsxs(Text, {\n          style: [utils.margin15Right, utils.margin5Bottom],\n          children: [_jsx(Text, {\n            style: [text.bold],\n            onPress: function onPress() {\n              return navigation.navigate(\"Profile\", {\n                uid: user.uid,\n                username: undefined\n              });\n            },\n            children: user.name\n          }), _jsx(Text, {\n            children: \"    \"\n          }), _jsx(ParsedText, {\n            parse: [{\n              pattern: /@(\\w+)/,\n              style: {\n                color: 'green',\n                fontWeight: 'bold'\n              },\n              onPress: onUsernamePress\n            }],\n            children: item.caption\n          })]\n        }), _jsxs(Text, {\n          style: [text.grey, utils.margin5Bottom],\n          onPress: function onPress() {\n            return navigation.navigate('CommentsScreen', {\n              postId: item.id,\n              uid: user.uid,\n              user: user\n            });\n          },\n          children: [\"View all \", item.commentsCount, \" Comments\"]\n        }), _jsx(Text, {\n          style: [text.grey, text.small, utils.margin5Bottom],\n          children: timeDifference(new Date(), item.creation.toDate())\n        })]\n      })]\n    }), _jsx(BottomSheet, {\n      bottomSheerColor: \"#FFFFFF\",\n      ref: setSheetRef,\n      initialPosition: 0,\n      snapPoints: [300, 0],\n      isBackDrop: true,\n      isBackDropDismissByPress: true,\n      isRoundBorderWithTipHeader: true,\n      backDropColor: \"black\",\n      isModal: true,\n      containerStyle: {\n        backgroundColor: \"white\"\n      },\n      tipStyle: {\n        backgroundColor: \"white\"\n      },\n      headerStyle: {\n        backgroundColor: \"white\",\n        flex: 1\n      },\n      bodyStyle: {\n        backgroundColor: \"white\",\n        flex: 1,\n        borderRadius: 20\n      },\n      body: _jsx(View, {\n        children: modalShow.item != null ? _jsxs(View, {\n          children: [_jsx(TouchableOpacity, {\n            style: {\n              padding: 20\n            },\n            onPress: function onPress() {\n              navigation.navigate(\"Profile\", {\n                uid: modalShow.item.user.uid,\n                username: undefined\n              });\n              setModalShow({\n                visible: false,\n                item: null\n              });\n            },\n            children: _jsx(Text, {\n              children: \"Profile\"\n            })\n          }), _jsx(Divider, {}), props.route.params.user.uid == auth.currentUser.uid ? _jsx(TouchableOpacity, {\n            style: {\n              padding: 20\n            },\n            onPress: function onPress() {\n              props.deletePost(modalShow.item).then(function () {\n                props.fetchUserPosts();\n                navigation.popToTop();\n              });\n              setModalShow({\n                visible: false,\n                item: null\n              });\n            },\n            children: _jsx(Text, {\n              children: \"Delete\"\n            })\n          }) : null, _jsx(Divider, {}), _jsx(TouchableOpacity, {\n            style: {\n              padding: 20\n            },\n            onPress: function onPress() {\n              return setModalShow({\n                visible: false,\n                item: null\n              });\n            },\n            children: _jsx(Text, {\n              children: \"Cancel\"\n            })\n          })]\n        }) : null\n      })\n    }), _jsx(Snackbar, {\n      visible: isValid.boolSnack,\n      duration: 2000,\n      onDismiss: function onDismiss() {\n        setIsValid({\n          boolSnack: false\n        });\n      },\n      children: isValid.message\n    })]\n  });\n}\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    currentUser: store.userState.currentUser,\n    following: store.userState.following,\n    feed: store.usersState.feed,\n    usersFollowingLoaded: store.usersState.usersFollowingLoaded\n  };\n};\n\nvar mapDispatchProps = function mapDispatchProps(dispatch) {\n  return bindActionCreators({\n    fetchUserPosts: fetchUserPosts,\n    deletePost: deletePost\n  }, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchProps)(Post);","map":{"version":3,"sources":["C:/Users/sim2a/Documents/codes/instagram-clone/components/home/Post.js"],"names":["React","useEffect","useRef","useState","Divider","Snackbar","arrayRemove","arrayUnion","collection","deleteDoc","doc","getDoc","onSnapshot","setDoc","updateDoc","useNavigation","useIsFocused","BottomSheet","ParsedText","connect","bindActionCreators","Entypo","Feather","FontAwesome5","fetchUserPosts","deletePost","container","text","utils","timeDifference","CachedImage","auth","db","WINDOW_WIDTH","Dimensions","get","width","Post","props","navigation","post","route","params","item","setItem","user","setUser","currentUserLike","setCurrentUserLike","unmutted","setUnmutted","videoref","setvideoref","sheetRef","setSheetRef","visible","modalShow","setModalShow","isValid","setIsValid","exists","setExists","loaded","setLoaded","isFocused","notification","undefined","userDoc","then","snapshot","data","uid","id","catch","error","console","log","userPostsRef","userPostRef","likesRef","currentUserDocRef","currentUser","currentUserRef","setIsMutedAsync","playAsync","stopAsync","index","inViewPort","handleLike","currentLikeStatus","likes_by_users","includes","postRef","owner_email","message","handleComment","navigate","postId","onUsernamePress","username","matchIndex","onLikePress","userId","likesCount","onDislikePress","height","justifyContent","margin","alignSelf","marginBottom","notAvailable","_handleVideoRef","component","current","feed","snapTo","backgroundWhite","horizontal","alignItems","padding","screen","image","profileImageSmall","uri","profile_picture","bold","medium","marginLeft","type","isLooping","shouldPlay","resizeMode","Video","RESIZE_MODE_COVER","source","downloadURL","videoRef","aspectRatio","backgroundColor","position","borderRadius","right","setUnmuttedMain","marginTop","downloadURLStill","margin15Left","padding10","share","padding10Sides","margin15Right","margin5Bottom","name","pattern","style","color","fontWeight","onPress","caption","grey","commentsCount","small","Date","creation","toDate","flex","popToTop","boolSnack","mapStateToProps","store","userState","following","usersState","usersFollowingLoaded","mapDispatchProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { View, Dimensions,Text,Image, TouchableOpacity } from 'react-native';\r\nimport { Divider, Snackbar } from 'react-native-paper';\r\nimport { arrayRemove, arrayUnion, collection, deleteDoc, doc,getDoc,onSnapshot,setDoc,updateDoc } from 'firebase/firestore';\r\nimport { useNavigation,useIsFocused } from '@react-navigation/native';\r\nimport BottomSheet from 'reanimated-bottom-sheet';\r\nimport ParsedText from 'react-native-parsed-text';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\nimport { Entypo, Feather, FontAwesome5 } from '@expo/vector-icons';\r\n\r\nimport { fetchUserPosts,deletePost } from '../../redux/actions';\r\nimport { container,text,utils } from '../styles';\r\nimport { timeDifference } from '../utils';\r\nimport CachedImage from '../CachedImage';\r\nimport { auth, db } from '../../firebase';\r\n\r\nconst WINDOW_WIDTH = Dimensions.get(\"window\").width;\r\n\r\nfunction Post(props) {\r\n  const navigation = useNavigation();\r\n  const post = props.post;\r\n  const [item, setItem] = useState(props.route.params.item)\r\n  const [user, setUser] = useState(props.route.params.user)\r\n  const [currentUserLike, setCurrentUserLike] = useState(false)\r\n  const [unmutted, setUnmutted] = useState(true)\r\n  const [videoref, setvideoref] = useState(null)\r\n  const [sheetRef, setSheetRef] = useState(useRef(null))\r\n  const [modalShow, setModalShow] = useState({ visible: false, item: null })\r\n  const [isValid, setIsValid] = useState(true);\r\n  const [exists, setExists] = useState(false);\r\n  const [loaded, setLoaded] = useState(false);\r\n\r\n  \r\n  const isFocused = useIsFocused();\r\n    useEffect(() => {\r\n\r\n        if (props.route.params.notification != undefined) {\r\n            const userDoc = doc(db,\"users\",props.route.params.user);\r\n            getDoc(userDoc).then((snapshot) => {\r\n                if (snapshot.exists) {\r\n                    let user = snapshot.data();\r\n                    user.uid = snapshot.id;\r\n\r\n                    setUser(user)\r\n                }\r\n            }).catch( error => console.log(error))\r\n\r\n            const userPostsRef = collection(db,\"posts\",props.route.params.user,\"userPosts\");    \r\n            const userPostRef = doc(userPostsRef, props.route.params.item);\r\n            getDoc(userPostRef).then((snapshot) => {\r\n                if (snapshot.exists) {\r\n                    let post = snapshot.data();\r\n                    post.id = snapshot.id;\r\n\r\n                    setItem(post)\r\n                    setLoaded(true)\r\n                    setExists(true)\r\n                }\r\n            }).catch( error => console.log(error))\r\n\r\n            const likesRef = collection(userPostsRef,props.route.params.item,\"likes\");\r\n            const currentUserDocRef = doc(likesRef, auth.currentUser.uid);\r\n\r\n            onSnapshot(currentUserDocRef,snapshot => {   \r\n                let currentUserLike = false;\r\n                if (snapshot.exists) {\r\n                    currentUserLike = true;\r\n                }\r\n                setCurrentUserLike(currentUserLike)       \r\n            })\r\n        }\r\n        else {\r\n            const currentUserRef = doc(db,\"posts\",props.route.params.user.uid,\"userPosts\",props.route.params.item.id,\"likes\",auth.currentUser.uid);\r\n            \r\n            onSnapshot(currentUserRef, (snapshot) => {\r\n                let currentUserLike = false;\r\n                if (snapshot.exists) {\r\n                    currentUserLike = true;\r\n                }\r\n                setCurrentUserLike(currentUserLike)\r\n            });\r\n            \r\n            setItem(props.route.params.item)\r\n            setUser(props.route.params.user)\r\n            setLoaded(true)\r\n            setExists(true)\r\n        }\r\n\r\n    }, [props.route.params.notification, props.route.params.item])\r\n\r\n    useEffect(() => {\r\n        if (videoref !== null) {\r\n            videoref.setIsMutedAsync(props.route.params.unmutted)\r\n        }\r\n        setUnmutted(props.route.params.unmutted)\r\n    }, [props.route.params.unmutted])\r\n\r\n    useEffect(() => {\r\n        if (videoref !== null) {\r\n            if (isFocused) {\r\n                videoref.playAsync()\r\n            } else {\r\n                videoref.stopAsync()\r\n\r\n            }\r\n        }\r\n\r\n    }, [props.route.params.index, props.route.params.inViewPort])\r\n\r\n  const handleLike = () => {\r\n    const currentLikeStatus = !post.likes_by_users?.includes(auth.currentUser.uid);  \r\n    const postRef = collection(db, \"users\", post.owner_email, \"posts\");\r\n\r\n    updateDoc(doc(postRef,post.id), {\r\n        likes_by_users: currentLikeStatus \r\n            ? arrayUnion(auth.currentUser.uid) \r\n            : arrayRemove(auth.currentUser.uid)\r\n    }).then( () => {\r\n        console.log('Document successfully added')\r\n    }).catch( error => {\r\n        console.log('Error updating document: ', error.message)\r\n    })\r\n  }\r\n  \r\n  const handleComment = (post) => {       \r\n      navigation.navigate('CommentsScreen',{ postId: post.id, uid: auth.currentUser.uid }) \r\n  }\r\n\r\n  const onUsernamePress = (username, matchIndex) => {\r\n    navigation.navigate(\"Profile\", { username, uid: undefined })\r\n  }\r\n\r\nconst onLikePress = (userId, postId, item) => {\r\n    item.likesCount += 1;\r\n    setCurrentUserLike(true)\r\n\r\n    const currentUserRef = doc(db,\"posts\",userId,\"userPosts\",postId,\"likes\",auth.currentUser.uid);\r\n    setDoc(currentUserRef, {});\r\n    // props.sendNotification(user.notificationToken, \"New Like\", `${props.currentUser.name} liked your post`, { type: 0, postId, user: firebase.auth().currentUser.uid })\r\n}\r\nconst onDislikePress = (userId, postId, item) => {\r\n    const currentUserRef = doc(db,\"posts\",userId,\"userPosts\",postId,\"likes\",auth.currentUser.uid);\r\n\r\n    deleteDoc(currentUserRef);\r\n}\r\n\r\nif (!exists && loaded) {\r\n    return (\r\n        <View style={{ height: '100%', justifyContent: 'center', margin: 'auto' }}>\r\n            <FontAwesome5 style={{ alignSelf: 'center', marginBottom: 20 }} name=\"dizzy\" size={40} color=\"black\" />\r\n            <Text style={[text.notAvailable]}>Post does not exist</Text>\r\n        </View>\r\n    )\r\n}\r\n\r\nif (!loaded) {\r\n    return (<View></View>)\r\n\r\n}\r\nif (user == undefined) {\r\n    return (<View></View>)\r\n}\r\nif (item == null) {\r\n    return (<View />)\r\n}\r\n\r\nconst _handleVideoRef = (component) => {\r\n    setvideoref(component);\r\n\r\n    if (component !== null) {\r\n        component.setIsMutedAsync(props.route.params.unmutted)\r\n    }\r\n}\r\n\r\nif (videoref !== null) {\r\n    videoref.setIsMutedAsync(unmutted)\r\n    if (isFocused && props.route.params.index == props.route.params.inViewPort) {\r\n        videoref.playAsync()\r\n    } else {\r\n        videoref.stopAsync()\r\n    }\r\n}\r\n\r\n\r\nif (sheetRef.current !== null && !props.route.params.feed) {\r\n    if (modalShow.visible) {\r\n        sheetRef.snapTo(0)\r\n    } else {\r\n        sheetRef.snapTo(1)\r\n    }\r\n}\r\n\r\n  return (\r\n    <View style={[container.container, utils.backgroundWhite]}>\r\n\r\n        <View>\r\n            <View style={[container.horizontal, { alignItems: 'center', padding: 10 }]}>\r\n                <TouchableOpacity\r\n                    style={[container.horizontal, { alignItems: 'center' }]}\r\n                    onPress={() => navigation.navigate(\"BottomTabs\",{ screen: \"ProfileScreen\", params: { uid: user.uid, username: undefined }})}>\r\n\r\n                    {user.image == 'default' ?\r\n                        (\r\n                            <FontAwesome5\r\n                                style={[utils.profileImageSmall]}\r\n                                name=\"user-circle\" size={35} color=\"black\" />\r\n                        )\r\n                        :\r\n                        (\r\n                            <Image\r\n                                style={[utils.profileImageSmall]}\r\n                                source={{\r\n                                    uri: user.profile_picture\r\n                                }}\r\n                            />\r\n                        )\r\n                    }\r\n                    <View style={{ alignSelf: 'center' }}>\r\n                        <Text style={[text.bold, text.medium, { marginBottom: 0 }]} >{user.username}</Text>\r\n                    </View>\r\n\r\n                </TouchableOpacity>\r\n\r\n                <TouchableOpacity\r\n                    style={[{ marginLeft: 'auto' }]}\r\n\r\n                    onPress={() => {\r\n                        if (props.route.params.feed) {\r\n                            props.route.params.setModalShow({ visible: true, item })\r\n                        } else {\r\n                            setModalShow({ visible: true, item })\r\n                        }\r\n                    }}>\r\n                    <Feather\r\n                        name=\"more-vertical\" size={20} color=\"black\" />\r\n                </TouchableOpacity>\r\n            </View>\r\n            {item.type == 0 ?\r\n                <>\r\n                    {props.route.params.index == props.route.params.inViewPort && isFocused ?\r\n                        <View>\r\n                            <VideoPlayer\r\n                                videoProps={{\r\n                                    isLooping: true,\r\n                                    shouldPlay: true,\r\n                                    resizeMode: Video.RESIZE_MODE_COVER,\r\n                                    source: {\r\n                                        uri: item.downloadURL,\r\n                                    },\r\n                                    videoRef: _handleVideoRef,\r\n                                }}\r\n                                inFullscreen={false}\r\n                                showControlsOnLoad={true}\r\n                                showFullscreenButton={false}\r\n                                height={WINDOW_WIDTH}\r\n                                width={WINDOW_WIDTH}\r\n                                shouldPlay={true}\r\n                                isLooping={true}\r\n                                style={{\r\n                                    aspectRatio: 1 / 1, height: WINDOW_WIDTH,\r\n                                    width: WINDOW_WIDTH, backgroundColor: 'black'\r\n                                }}\r\n                            />\r\n\r\n                            <TouchableOpacity\r\n                                style={{ position: 'absolute', borderRadius: 500, backgroundColor: 'black', width: 40, height: 40, alignItems: 'center', justifyContent: 'center', margin: 10, right: 0 }}\r\n                                activeOpacity={1}\r\n                                onPress={() => {\r\n                                    if (videoref == null) {\r\n                                        return;\r\n                                    }\r\n                                    if (unmutted) {\r\n                                        if (props.route.params.setUnmuttedMain == undefined) {\r\n                                            setUnmutted(false)\r\n                                        } else {\r\n                                            props.route.params.setUnmuttedMain(false)\r\n                                        }\r\n\r\n                                    } else {\r\n                                        if (props.route.params.setUnmuttedMain == undefined) {\r\n                                            setUnmutted(true)\r\n                                        } else {\r\n                                            props.route.params.setUnmuttedMain(true)\r\n                                        }\r\n\r\n                                    }\r\n\r\n                                }}>\r\n                                {!unmutted ?\r\n                                    <Feather name=\"volume-2\" size={20} color=\"white\" />\r\n                                    :\r\n                                    <Feather name=\"volume-x\" size={20} color=\"white\" />\r\n                                }\r\n                            </TouchableOpacity>\r\n                        </View>\r\n\r\n                        :\r\n                        <View style={{ marginTop: 4 }}>\r\n\r\n                            <CachedImage\r\n                                cacheKey={item.id}\r\n                                style={[container.image]}\r\n                                source={{ uri: item.downloadURLStill }}\r\n                            />\r\n                        </View>\r\n                    }\r\n                </>\r\n                :\r\n                <CachedImage\r\n                    cacheKey={item.id}\r\n                    style={container.image}\r\n                    source={{ uri: item.downloadURL }}\r\n                />\r\n            }\r\n                <Feather style={utils.margin15Left} name=\"message-square\" size={30} color=\"black\" onPress={() => navigation.navigate('CommentsScreen', { postId: item.id, uid: user.uid, user })} />\r\n\r\n            <View style={[utils.padding10, container.horizontal]}>\r\n                {currentUserLike ?\r\n                    (\r\n                        <TouchableOpacity onPress={() => onDislikePress(user.uid, item.id, item)}>\r\n                            <Entypo name=\"heart\" size={30} color=\"red\" />\r\n                        </TouchableOpacity>\r\n                    )\r\n                    :\r\n                    (\r\n                        <TouchableOpacity onPress={() => onLikePress(user.uid, item.id, item)}>\r\n                            <Feather name=\"heart\" size={30} color=\"black\" />\r\n                        </TouchableOpacity>                        \r\n                    )\r\n                }\r\n                \r\n\r\n                <Feather style={utils.margin15Left} name=\"share\" size={26} color=\"black\" onPress={() => navigation.navigate('ChatList', { postId: item.id, post: { ...item, user: user }, share: true })} />\r\n            </View>\r\n            <View style={[container.container, utils.padding10Sides]}>\r\n                <Text style={[text.bold, text.medium]}>\r\n                    {item.likesCount} likes\r\n                </Text>\r\n                <Text style={[utils.margin15Right, utils.margin5Bottom]}>\r\n                    <Text style={[text.bold]}\r\n                        onPress={() => navigation.navigate(\"Profile\", { uid: user.uid, username: undefined })}>\r\n                        {user.name}\r\n                    </Text>\r\n\r\n                    <Text>    </Text>\r\n                    <ParsedText\r\n                        parse={\r\n                            [\r\n                                { pattern: /@(\\w+)/, style: { color: 'green', fontWeight: 'bold' }, onPress: onUsernamePress },\r\n                            ]\r\n                        }\r\n                    >{item.caption}</ParsedText>\r\n\r\n                </Text>\r\n                <Text\r\n                    style={[text.grey, utils.margin5Bottom]} onPress={() => navigation.navigate('CommentsScreen', { postId: item.id, uid: user.uid, user })}>\r\n                    View all {item.commentsCount} Comments\r\n                </Text>\r\n                <Text\r\n                    style={[text.grey, text.small, utils.margin5Bottom]}>\r\n                    {timeDifference(new Date(), item.creation.toDate())}\r\n                </Text>\r\n            </View>\r\n        </View>\r\n\r\n        <BottomSheet\r\n            bottomSheerColor=\"#FFFFFF\"\r\n            ref={setSheetRef}\r\n            initialPosition={0} //200, 300\r\n            snapPoints={[300, 0]}\r\n            isBackDrop={true}\r\n            isBackDropDismissByPress={true}\r\n            isRoundBorderWithTipHeader={true}\r\n            backDropColor=\"black\"\r\n            isModal\r\n            containerStyle={{ backgroundColor: \"white\" }}\r\n            tipStyle={{ backgroundColor: \"white\" }}\r\n            headerStyle={{ backgroundColor: \"white\", flex: 1 }}\r\n            bodyStyle={{ backgroundColor: \"white\", flex: 1, borderRadius: 20 }}\r\n            body={\r\n\r\n                <View>\r\n\r\n                    {modalShow.item != null ?\r\n                        <View>\r\n                            <TouchableOpacity style={{ padding: 20 }}\r\n                                onPress={() => {\r\n                                    navigation.navigate(\"Profile\", { uid: modalShow.item.user.uid, username: undefined });\r\n                                    setModalShow({ visible: false, item: null });\r\n                                }}>\r\n                                <Text >Profile</Text>\r\n                            </TouchableOpacity>\r\n                            <Divider />\r\n                            {props.route.params.user.uid == auth.currentUser.uid ?\r\n                                <TouchableOpacity style={{ padding: 20 }}\r\n                                    onPress={() => {\r\n                                        props.deletePost(modalShow.item).then(() => {\r\n                                            props.fetchUserPosts()\r\n                                            navigation.popToTop()\r\n                                        })\r\n                                        setModalShow({ visible: false, item: null });\r\n                                    }}>\r\n                                    <Text >Delete</Text>\r\n                                </TouchableOpacity>\r\n                                : null}\r\n\r\n                            <Divider />\r\n                            <TouchableOpacity style={{ padding: 20 }} onPress={() => setModalShow({ visible: false, item: null })}>\r\n                                <Text >Cancel</Text>\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                        : null}\r\n\r\n                </View>\r\n            }\r\n        />\r\n        <Snackbar\r\n            visible={isValid.boolSnack}\r\n            duration={2000}\r\n            onDismiss={() => { setIsValid({ boolSnack: false }) }}>\r\n            {isValid.message}\r\n        </Snackbar>\r\n    </View>\r\n)\r\n} \r\n\r\nconst mapStateToProps = (store) => ({\r\n    currentUser: store.userState.currentUser,\r\n    following: store.userState.following,\r\n    feed: store.usersState.feed,\r\n    usersFollowingLoaded: store.usersState.usersFollowingLoaded,\r\n})\r\n\r\nconst mapDispatchProps = (dispatch) => bindActionCreators({ fetchUserPosts,deletePost }, dispatch);\r\n\r\nexport default connect(mapStateToProps, mapDispatchProps)(Post);"]},"metadata":{},"sourceType":"module"}